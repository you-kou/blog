# 配置并使用Postman模拟服务器

在Postman中创建模拟服务器，以帮助API开发和测试。模拟服务器通过接收请求并返回响应来模拟真实的API服务器。通过为集合配置模拟服务器并向请求添加示例，你可以模拟真实API的行为。

当你向模拟服务器发送请求时，Postman会将请求与集合中保存的示例进行匹配，然后返回示例中的数据。要查看工作区中的现有模拟服务器，请在侧边栏中选择 **Mock servers**。

模拟服务器可以是私有的或公共的。**私有模拟服务器** 需要在请求头中提供Postman API密钥。**公共模拟服务器** 可以接收来自任何人和任何地方的请求（如浏览器、应用程序代码或curl命令）。

新建的模拟服务器默认设置为私有。**超级管理员** 和 **团队管理员** 可以允许或禁止用户创建公共模拟服务器。

> [!NOTE]
>
> Postman模拟服务器支持HTTP集合。你无法在多协议集合中使用模拟服务器。

## 模拟服务器快速开始

要为API创建模拟服务器，请按照以下步骤操作：

1. **在Postman中发送HTTP请求** —— 例如 `https://postman-echo.com/get`。
2. **点击保存图标**，将请求保存到一个集合中。
3. **在响应面板中选择示例图标**，然后点击 **保存响应**。Postman会自动用你收到的响应填充示例。
4. **在侧边栏选择“Collections”**（集合），找到保存请求的集合，点击集合旁的 **更多操作图标**，选择 **“Mock collection”**（模拟集合）。
5. **给你的模拟服务器起个名字**，保持其他设置为默认值，点击 **“Create Mock Server”**（创建模拟服务器）。
6. **点击复制图标**复制模拟服务器的URL，然后回到你的请求，将URL的基础部分（路径前的部分，比如直到 `/get`）替换为模拟服务器的URL。
7. **在请求的Headers标签页**，添加 **`x-api-key`** 头，值为你的Postman API密钥。
8. **点击“发送”**，Postman会返回你保存的示例响应，这次来自模拟服务器。
9. **打开示例并修改响应**，保存示例后再次发送请求，Postman会返回你编辑后的模拟响应。

## 创建模拟服务器

你可以从**零开始**、**集合**或**历史记录**创建新的模拟服务器。

### 从零开始创建模拟服务器

1. **在侧边栏选择“Mock servers”**，然后点击 **添加图标** 创建模拟服务器。
    ![](https://assets.postman.com/postman-docs/v11/mock-server-new-v11-8.jpg)

2. 选择一个现有的集合。你也可以创建一个新集合，添加一个或多个请求，然后选择 **下一步**。
    ![](https://assets.postman.com/postman-docs/v11/mock-server-add-collection-v11-16.jpg)

3. 配置你的模拟服务器详细信息。

### 从集合创建模拟服务器

1. **在侧边栏选择“Collections”**（集合）。
2. **点击集合旁的“更多操作图标”**，选择 **“Mock collection”**（模拟集合）。
    ![](https://assets.postman.com/postman-docs/v11/mock-server-mock-collection-v11-8.jpg)

3. 配置你的模拟服务器详细信息。

## 配置模拟服务器详细信息

> [!NOTE]
>
> 根据你创建模拟服务器的方法，某些配置选项可能会有所不同。

1. 要完成模拟服务器的创建，请指定以下详细信息：
   - **模拟服务器名称** — 输入你的模拟服务器名称。
   - **集合** — 选择用于模拟服务器的集合。如果要选择其他集合，点击 **返回**。
   - **环境** — （可选）选择一个环境，以便在模拟服务器中使用环境变量。
   - **将模拟服务器URL保存为新环境变量** — 选择此选项，将模拟服务器URL保存为新环境中的变量，然后可以在请求中引用该变量。了解如何在模拟服务器中使用变量。
   - **模拟固定的网络延迟** — 选择响应延迟或输入自定义延迟。模拟服务器将在指定时间后发送响应。
   - **将模拟服务器设为私有** — 选择此选项将模拟服务器设置为私有。发送请求到私有模拟服务器时，必须在请求头中指定API密钥。了解如何向私有模拟服务器发起请求。

> [!CAUTION]
>
> 如果 **“将模拟服务器设为私有”** 选项不可用，可能是在团队资源中已关闭。**团队管理员** 或 **超级管理员** 可以重新启用此选项。

2. 选择 **创建模拟服务器**。
    Postman会显示你使用模拟服务器所需的详细信息。你可以随时通过在侧边栏选择 **Mock servers** 并选择相应的模拟服务器来查看这些详细信息。
    ![](https://assets.postman.com/postman-docs/v11/mock-server-configure-details-v11-20.png)
  
3. 点击 **复制图标** 复制URL，以开始向你的模拟服务器发起请求。
    ![](https://assets.postman.com/postman-docs/v11/mock-server-get-url-v11-8.jpg)

### 编辑模拟服务器配置

你可以随时更改模拟服务器的配置。

1. 在侧边栏选择 **Mock servers**。
2. 选择一个模拟服务器，然后点击 **设置图标**，选择 **编辑配置**。
    ![](https://assets.postman.com/postman-docs/v11/mock-server-edit-configuration-v11-8.jpg)

3. 对模拟服务器配置进行任何更改。你可以更改模拟服务器的名称、环境、网络延迟和隐私设置，还可以指定响应匹配的选项。
    > [!NOTE]
    >
    > 你无法更改模拟服务器的集合。如果需要模拟不同的集合，请创建一个新的模拟服务器。

4. 完成配置更改后，选择 **更新模拟服务器**。

### 匹配请求体和头部

当你向模拟服务器发送请求时，Postman会使用匹配算法来决定返回哪个示例响应。

默认情况下，匹配算法在选择要返回的最佳响应时不会考虑请求的主体或头部。你可以在模拟服务器的配置中更改此行为。通过使用请求体或头部匹配，你可以指定模拟服务器返回的确切响应，通过匹配保存的示例的主体或头部。

要在模拟服务器中使用请求体或头部匹配，请按以下步骤操作：

1. 在侧边栏选择 **Mock servers**，选择一个模拟服务器，然后点击 **设置图标**，选择 **编辑配置**。
2. 在响应匹配部分，选择你要使用的匹配选项：
   - **请求体** — 模拟服务器将请求的主体与保存的示例主体进行匹配。
   - **头部** — 模拟服务器将请求的头部与保存的示例头部进行匹配。在框中添加你希望模拟服务器匹配的头部键，键之间用逗号分隔。头部匹配不区分大小写。
3. 选择 **更新模拟服务器**。

![](https://assets.postman.com/postman-docs/v11/mock-server-header-body-matching-v11-8.jpg)

### 删除模拟服务器

要删除模拟服务器，在侧边栏选择 **Mock servers**，点击模拟服务器名称旁的 **更多操作图标**，然后选择 **删除**。

## 向模拟服务器发起请求

使用模拟服务器的URL向模拟服务器发起请求。

1. 在侧边栏选择 **Mock servers**，选择一个模拟服务器，然后点击 **复制图标** 复制URL。

2. 打开一个新请求（或编辑现有请求中的地址），并添加模拟服务器的URL。该URL包括模拟服务器的ID和你要模拟的请求路径。例如：

   ```
   https://4bb57fc2-219e-421e-86b4-4ffda6bf1b3b.mock.pstmn.io/get
   ```

3. 如果你的模拟服务器是私有的，向请求中添加你的Postman API密钥作为 **x-api-key** 头。了解如何向私有模拟服务器发起请求。

4. 选择 **发送** 将请求发送到模拟服务器。

> [!CAUTION]
>
> 确保你要模拟的请求至少有一个已保存的示例。了解如何为请求添加示例。

![](https://assets.postman.com/postman-docs/v11/mock-server-send-request-v11-8.jpg)

当你向模拟服务器发送请求时，模拟服务器会根据具有相同路径和方法的示例返回响应。你可以提供多个示例，Postman会返回与请求最匹配的一个。

如果你为模拟服务器配置了延迟，Postman会在发送响应之前等待指定的时间。

> [!IMPORTANT]
>
> 你的Postman计划每月提供有限次数的免费模拟服务器调用。了解更多关于Postman资源使用的信息。

### 向私有模拟服务器发起请求

默认情况下，新创建的Postman模拟服务器是私有的。你可以通过编辑配置将模拟服务器设置为公开。

要向私有模拟服务器发起请求，你需要在请求头中添加Postman API密钥： `x-api-key:<Your-Postman-API-key>`。如果你共享集合，其他人可以使用他们的Postman API密钥向模拟服务器发起请求。

### 为模拟服务器使用HTTP访问控制

除了使用Postman调用模拟端点外，你还可以使用Web浏览器向模拟服务器发起请求。

当Web浏览器从不同的域、协议或端口请求资源时，它会发起跨域HTTP请求。跨域资源共享（CORS）是一个标准，定义了浏览器和服务器如何安全地进行交互。在此情况下，CORS指的是Web浏览器如何与托管在Postman模拟服务器上的模拟端点交互。

Postman模拟服务器已启用CORS，因此你可以使用模拟端点用模拟数据替代你的Web应用。然后，开发或生产环境中的Web应用可以向Postman模拟端点发起请求并接收示例响应。

## 查看模拟服务器调用日志

你可以使用模拟调用日志查看和搜索对模拟服务器的调用详细信息。要查看调用日志，请按以下步骤操作：

1. 在侧边栏选择 **Mock servers**。
2. 选择一个模拟服务器。

![](https://assets.postman.com/postman-docs/v11/mock-server-call-log-v11-8.jpg)

调用日志显示了对模拟服务器URL发起的请求列表。每条记录显示了请求发送的时间、请求方法和路径，以及响应概览。

你可以通过以下方式操作模拟服务器调用日志：

- 在搜索框中输入文本以查找特定的请求。
- 选择 **刷新图标** 刷新日志，查看最新的请求。
- 选择某条记录以查看请求头和请求体或响应头和响应体的详细信息。
- 选择 **删除图标** 删除该记录。
- 要复制模拟服务器的URL，选择 **复制图标** 复制URL。你可以使用该URL向模拟服务器发起请求。
- 要查看模拟集合的文档，选择 **文档图标** 查看集合文档。

### 排查模拟调用问题

你可以使用模拟调用日志来排查向模拟服务器发起请求时的问题。

如果在 **响应** 列中显示 **无匹配请求**，这可能意味着你的模拟服务器配置存在问题。确保在你模拟的集合中为请求保存了一个示例。

![](https://assets.postman.com/postman-docs/v11/mock-server-no-match-v11-8a.jpg)

如果发生服务中断，你将收到502、503或504的响应。请查看Postman的状态页面以获取最新的更新。
